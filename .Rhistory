#plot frequency of frequencies
ggplot(data = gene.count, aes(x=gene.count$Freq)) + geom_histogram(binwidth=1) + geom_vline(xintercept = 3)
#stats
print(paste("proportion contigs with gene count >= 3:",nrow(subset(gene.count, gene.count$Freq >= 3))/nrow(gene.count)*100))
print(paste("Median no. genes/contig:",median(gene.count$Freq)))
print(paste("Max no. genes/contig:",max(gene.count$Freq)))
#install bioconductor 3.8 https://www.bioconductor.org/install/
#install Biostrings: BiocManager::install("Biostrings", version = "3.8") ; do not update mclust because it will have a warning and then biostrings module not installed.
#~~~~~ Beginning of 'story''s code.~~~~~
## read your fasta in as Biostrings object
fasta.s <- readDNAStringSet("./data/sample_data/fasta_sample.fasta")
## get the read names (in your case it has the isoform info)
names.fasta <- names(fasta.s)
## extract only the relevant gene and isoform (JM: aka pep) id (split name by the period symbol)
#JM: modify line to fit my name format
gene.iso <- sapply(names.fasta,function(j) cbind(unlist(strsplit(j,'\\:'))[1:8]))
## convert to good data.frame = transpose result from previous step and add relevant column names
gene.iso.df <- data.frame(t(gene.iso))
#JM: alter to put your own column names in:
colnames(gene.iso.df) <- c('p','pepID','s','scaffID','g','geneID','t','transID')
gene.iso.df<-select(gene.iso.df, geneID, pepID)
## and length of isoforms
gene.iso.df$width <- width(fasta.s)
#Did not use rest of code.
#~~~~~ End of 'story''s code.~~~~~
#JM:
gene.iso.df<-rownames_to_column(gene.iso.df)
#~~~~~beginning of code by nassimhddd (Jul 18 '16) Stackoverflow~~~~~
longest.pep.df <-gene.iso.df%>%group_by(geneID)%>%mutate(the_rank = rank(-width,ties.method="random")) %>%filter(the_rank==1)%>%select(-the_rank)
#~~~~~End of nassimhddd's code.~~~~~
list<-longest.pep.df[,1,drop=FALSE]
#wait why doesn't col.names=FALSE remove the column name?? Oh well.
write.csv(list,"Hydra_longestpep.txt",quote=FALSE,row.names=FALSE)
#set up empty df to rbind to
all.df<-data.frame(matrix(ncol=5,nrow=0))
names<-c("seqid","type","start","end","attributes")
colnames(all.df)<-names
#set up file names to loop through
gff3_dir="data/genomes/gff3/"
gff3=c("Amphimedon_queenslandica.Aqu1.42.gff3","Capitella_teleta.Capitella_teleta_v1.0.42.gff3","Danio_rerio.GRCz11.95.gff3","Drosophila_melanogaster.BDGP6.95.gff3","Helobdella_robusta.Helro1.42.gff3","Homo_sapiens.GRCh38.95.gff3","Lottia_gigantea.Lotgi1.42.gff3","Mnemiopsis_leidyi.MneLei_Aug2011.42.gff3","Nematostella_vectensis.ASM20922v1.42.gff3","Strongylocentrotus_purpuratus.Spur_3.1.42.gff3","Taeniopygia_guttata.taeGut3.2.4.95.gff3","Trichoplax_adhaerens.ASM15027v1.42.gff3")
for (blah in gff3)
{
gff3_path<-paste0(gff3_dir,blah)
contig.gene.df <- ape::read.gff(file=gff3_path, GFF3=TRUE) %>% dplyr::select(.,"seqid","type","start","end","attributes") %>% filter(.,type == "gene")
all.df<-bind_rows(all.df,contig.gene.df)
}
#Parse out the gene_id from the attributes
all.df$gene<-gsub(".*gene_id=(.*?);.*","\\1",all.df$attributes)
#Begin contstruction of MASTAAA! table.
master.table<-select(all.df,"seqid","start","end","gene")
#need to add animal ids"
master.table$animal<-c(rep.int("Amphimedon_queenslandica",43615),rep.int("Capitella_telata",32175),rep.int("Danio_rerio",25606),rep.int("Drosophila_melanogaster",13931),rep.int("Helobdella_robusta",23432),rep.int("Homo_sapiens",21492),rep.int("Lottia_gigantea",23349),rep.int("Mnemiopsis_leidyi",16559),rep.int("Nematostella_vectensis",24773),rep.int("Strongylocentrotus_purpuratus",28987),rep.int("Taeniopygia_guttata",17488),rep.int("Trichoplax_adhaerens",11520))
write.csv(master.table,"master.table.csv",quote=FALSE,row.names=FALSE)
#Read in amalga homologs csv
agalma.homologs<-read.csv("compgen_homologs_nohydra_geneNames.csv",header=TRUE,sep=",")
#left join because need to know which genes have no homology too.
final.master.table<-left_join(master.table,agalma.homologs)%>%select(.,"seqid","start","end","gene","homology_id","catalog_id","animal")
write.csv(final.master.table,"final.master.table_absentgenes.csv",quote=FALSE,row.names=FALSE)
#double check that there are no duplicate genes in final.master.table
#duplicated(final.master.table$gene)%>%table()
#must run previous chunk first
#Take a subset! Otherwise following code will not complete running and freeze everything!!!
filter_target=c("Homo_sapiens","Danio_rerio","Drosophila_melanogaster")
master.table<-filter(master.table, animal==filter_target)
#There are human gene names in pep files that are not anywhere in gff3 files = inner_join
#Scaffold names may not be unique but must be - join seqid and catalog id
final.master.table_cluster<-inner_join(master.table,agalma.homologs)%>%dplyr::select(.,seqid,start,end,gene,homology_id,catalog_id)%>%mutate(species_scaffold=str_c(seqid,catalog_id,sep="_"))%>%dplyr::select(.,species_scaffold,homology_id)
#make contingency table
contingency<-table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)%>%as.matrix()
contingency<-1*(contingency>0)
#dissimilarity matrix
dist.matrix<-daisy(contingency,metric="gower",stand=FALSE)
#cluster
hac<-agnes(dist.matrix,diss=TRUE)
plot(hac)
library(CrossClustering)
cross.clust<-cc_crossclustering(dist.matrix,k_w_min=23,out=FALSE)
cc_get_cluster(cross.clust)
cross.clust
cca<-cca(contingency)
install.packages(cca)
library(CCA)
install.packages("CCA")
library(CCA)
cca<-cca(contingency)
cca<-CCA::cca(contingency)
install.packages("vegan")
library(vegan)
cca<-cca(contingency)
par(mfrow=c(1,2))
plot(ca, scaling=1,main="blah")
plot(cca, scaling=1,main="blah")
contingency_t<-t(contingency)
cca<-cca(contingency_t)
par(mfrow=c(1,2))
plot(ca, scaling=1,main="blah2")
plot(cca, scaling=1,main="blah2")
#must run previous chunk first
#Take a subset! Otherwise following code will not complete running and freeze everything!!!
filter_target=c("Homo_sapiens","Danio_rerio")
master.table<-filter(master.table, animal==filter_target)
#There are human gene names in pep files that are not anywhere in gff3 files = inner_join
#Scaffold names may not be unique but must be - join seqid and catalog id
final.master.table_cluster<-inner_join(master.table,agalma.homologs)%>%dplyr::select(.,seqid,start,end,gene,homology_id,catalog_id)%>%mutate(species_scaffold=str_c(seqid,catalog_id,sep="_"))%>%dplyr::select(.,species_scaffold,homology_id)
#make contingency table
contingency<-table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)%>%as.matrix()
contingency<-1*(contingency>0)
#dissimilarity matrix
dist.matrix<-daisy(contingency,metric="gower",stand=FALSE)
#cluster
hac<-agnes(dist.matrix,diss=TRUE)
plot(hac)
library(CrossClustering)
cross.clust<-cc_crossclustering(dist.matrix,k_w_min=23,out=FALSE)
cc_get_cluster(cross.clust)
ca<-cca(contingency)
par(mfrow=c(1,2))
plot(ca, scaling=1, main="vkag")
View(contingency)
library("FactoMineR")
CA(contingency_t,graph=TRUE)
CA(contingency,graph=TRUE)
ncol(contingency)
nrow(contingency)
#must run previous chunk first
#Take a subset! Otherwise following code will not complete running and freeze everything!!!
filter_target=c("Homo_sapiens")
master.table<-filter(master.table, animal==filter_target)
#There are human gene names in pep files that are not anywhere in gff3 files = inner_join
#Scaffold names may not be unique but must be - join seqid and catalog id
final.master.table_cluster<-inner_join(master.table,agalma.homologs)%>%dplyr::select(.,seqid,start,end,gene,homology_id,catalog_id)%>%mutate(species_scaffold=str_c(seqid,catalog_id,sep="_"))%>%dplyr::select(.,species_scaffold,homology_id)
#make contingency table
contingency<-table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)%>%as.matrix()
contingency<-1*(contingency>0)
#dissimilarity matrix
dist.matrix<-daisy(contingency,metric="gower",stand=FALSE)
#cluster
hac<-agnes(dist.matrix,diss=TRUE)
plot(hac)
library(CrossClustering)
cross.clust<-cc_crossclustering(dist.matrix,k_w_min=23,out=FALSE)
cc_get_cluster(cross.clust)
cca(contingency,graph=TRUE)
par(mfrow=c(1,2))
blah<-cca(contingency,graph=TRUE)
par(mfrow=c(1,2))
plot(blah, scaling=1, main="Biplot freq table col")
install.packages(kmed)
install.packages("kmed")
library(kmed)
cooccur(contingency)
#must run previous chunk first
#Take a subset! Otherwise following code will not complete running and freeze everything!!!
filter_target=c("Homo_sapiens","Danio_rerio")
master.table<-filter(master.table, animal==filter_target)
#There are human gene names in pep files that are not anywhere in gff3 files = inner_join
#Scaffold names may not be unique but must be - join seqid and catalog id
final.master.table_cluster<-inner_join(master.table,agalma.homologs)%>%dplyr::select(.,seqid,start,end,gene,homology_id,catalog_id)%>%mutate(species_scaffold=str_c(seqid,catalog_id,sep="_"))%>%dplyr::select(.,species_scaffold,homology_id)
#make contingency table
contingency<-table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)%>%as.matrix()
contingency<-1*(contingency>0)
#dissimilarity matrix
dist.matrix<-daisy(contingency,metric="gower",stand=FALSE)
#cluster
ag<-agnes(dist.matrix,diss=TRUE)
plot(ag)
cross.clust<-cc_crossclustering(dist.matrix,k_w_min=23,out=FALSE)
cross.clust<-cc_crossclustering(dist.matrix,out=FALSE)
cc_get_cluster(cross.clust)
#must run previous chunk first
#Take a subset! Otherwise following code will not complete running and freeze everything!!!
filter_target=c("Homo_sapiens","Danio_rerio")
master.table<-filter(master.table, animal==filter_target)
#There are human gene names in pep files that are not anywhere in gff3 files = inner_join
#Scaffold names may not be unique but must be - join seqid and catalog id
final.master.table_cluster<-inner_join(master.table,agalma.homologs)%>%dplyr::select(.,seqid,start,end,gene,homology_id,catalog_id)%>%mutate(species_scaffold=str_c(seqid,catalog_id,sep="_"))%>%dplyr::select(.,species_scaffold,homology_id)
#make contingency table
contingency<-table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)%>%as.matrix()
contingency<-1*(contingency>0)
#dissimilarity matrix
dist.matrix<-daisy(contingency,metric="gower",stand=FALSE)
#cluster
ag<-agnes(dist.matrix,diss=TRUE)
plot(ag)
cross.clust<-cc_crossclustering(dist.matrix,out=FALSE)
cc_get_cluster(cross.clust)
View(master.table)
#must run previous chunk first
#Take a subset! Otherwise following code will not complete running and freeze everything!!!
filter_target=c("Homo_sapiens","Danio_rerio")
master.table<-filter(master.table, animal==filter_target)
#There are human gene names in pep files that are not anywhere in gff3 files = inner_join
#Scaffold names may not be unique but must be - join seqid and catalog id
final.master.table_cluster<-inner_join(master.table,agalma.homologs)%>%dplyr::select(.,seqid,start,end,gene,homology_id,catalog_id)%>%mutate(species_scaffold=str_c(seqid,catalog_id,sep="_"))%>%dplyr::select(.,species_scaffold,homology_id)
#make contingency table
contingency<-table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)%>%as.matrix()
contingency<-1*(contingency>0)
#dissimilarity matrix
dist.matrix<-daisy(contingency,metric="gower",stand=FALSE)
#cluster
ag<-agnes(dist.matrix,diss=TRUE)
plot(ag)
cross.clust<-cc_crossclustering(dist.matrix,out=FALSE)
cc_get_cluster(cross.clust)
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
echo=FALSE,
dpi=300,
cache=TRUE
)
library( tidyverse )
library(ggplot2)
library(seqinr)
library(ape)
library(Biostrings)
library(dplyr)
#clustering
library(cluster)
library(CrossClustering)
library(vegan)
#NOTE: due to lfs not working for public forks I am unable to host genome fastas in repo. Links to data provided in readme. For convenience I've included sample data.
#Ideally I would loop through all my fastas but for some reason I can't get looping to work...
fasta="data/sample_data/fasta_sample.fasta"
#histogram of contig lengths
read.fasta(fasta)%>%getLength(fasta)%>%as.data.frame()%>%filter(.<10000)%>%ggplot()+geom_histogram(aes(x=.), fill="skyblue3", color="black",binwidth=100)+xlab("Scaffold Length")
#stats
print(paste("Median scaffold/contig length (bp):",getLength(fasta)%>%median()))
#Please replace gff3_sample.gff3 with path to desired gff3 file. GFF3 files can be found in data/genomes/annot
#install.packages("ape")
gff3="data/sample_data/gff3_sample.gff3"
#parse gff3 and create new df with only seqid, type, start and end. Keep start and end coords for later analyses.
contig.gene.df <- ape::read.gff(file=gff3, GFF3=TRUE) %>% select(.,"seqid","type","start","end") %>% filter(.,type == "gene")
#for histogram, take just the contig names and gene counts
gene.count<- as.data.frame(table(contig.gene.df$seqid))
#plot frequency of frequencies
ggplot(data = gene.count, aes(x=gene.count$Freq)) + geom_histogram(binwidth=1) + geom_vline(xintercept = 3)
#stats
print(paste("proportion contigs with gene count >= 3:",nrow(subset(gene.count, gene.count$Freq >= 3))/nrow(gene.count)*100))
print(paste("Median no. genes/contig:",median(gene.count$Freq)))
print(paste("Max no. genes/contig:",max(gene.count$Freq)))
#install bioconductor 3.8 https://www.bioconductor.org/install/
#install Biostrings: BiocManager::install("Biostrings", version = "3.8") ; do not update mclust because it will have a warning and then biostrings module not installed.
#~~~~~ Beginning of 'story''s code.~~~~~
## read your fasta in as Biostrings object
fasta.s <- readDNAStringSet("./data/sample_data/fasta_sample.fasta")
## get the read names (in your case it has the isoform info)
names.fasta <- names(fasta.s)
## extract only the relevant gene and isoform (JM: aka pep) id (split name by the period symbol)
#JM: modify line to fit my name format
gene.iso <- sapply(names.fasta,function(j) cbind(unlist(strsplit(j,'\\:'))[1:8]))
## convert to good data.frame = transpose result from previous step and add relevant column names
gene.iso.df <- data.frame(t(gene.iso))
#JM: alter to put your own column names in:
colnames(gene.iso.df) <- c('p','pepID','s','scaffID','g','geneID','t','transID')
gene.iso.df<-select(gene.iso.df, geneID, pepID)
## and length of isoforms
gene.iso.df$width <- width(fasta.s)
#Did not use rest of code.
#~~~~~ End of 'story''s code.~~~~~
#JM:
gene.iso.df<-rownames_to_column(gene.iso.df)
#~~~~~beginning of code by nassimhddd (Jul 18 '16) Stackoverflow~~~~~
longest.pep.df <-gene.iso.df%>%group_by(geneID)%>%mutate(the_rank = rank(-width,ties.method="random")) %>%filter(the_rank==1)%>%select(-the_rank)
#~~~~~End of nassimhddd's code.~~~~~
list<-longest.pep.df[,1,drop=FALSE]
#wait why doesn't col.names=FALSE remove the column name?? Oh well.
write.csv(list,"Hydra_longestpep.txt",quote=FALSE,row.names=FALSE)
#set up empty df to rbind to
all.df<-data.frame(matrix(ncol=5,nrow=0))
names<-c("seqid","type","start","end","attributes")
colnames(all.df)<-names
#set up file names to loop through
gff3_dir="data/genomes/gff3/"
gff3=c("Amphimedon_queenslandica.Aqu1.42.gff3","Capitella_teleta.Capitella_teleta_v1.0.42.gff3","Danio_rerio.GRCz11.95.gff3","Drosophila_melanogaster.BDGP6.95.gff3","Helobdella_robusta.Helro1.42.gff3","Homo_sapiens.GRCh38.95.gff3","Lottia_gigantea.Lotgi1.42.gff3","Mnemiopsis_leidyi.MneLei_Aug2011.42.gff3","Nematostella_vectensis.ASM20922v1.42.gff3","Strongylocentrotus_purpuratus.Spur_3.1.42.gff3","Taeniopygia_guttata.taeGut3.2.4.95.gff3","Trichoplax_adhaerens.ASM15027v1.42.gff3")
for (blah in gff3)
{
gff3_path<-paste0(gff3_dir,blah)
contig.gene.df <- ape::read.gff(file=gff3_path, GFF3=TRUE) %>% dplyr::select(.,"seqid","type","start","end","attributes") %>% filter(.,type == "gene")
all.df<-bind_rows(all.df,contig.gene.df)
}
#Parse out the gene_id from the attributes
all.df$gene<-gsub(".*gene_id=(.*?);.*","\\1",all.df$attributes)
#Begin contstruction of MASTAAA! table.
master.table<-select(all.df,"seqid","start","end","gene")
#need to add animal ids"
master.table$animal<-c(rep.int("Amphimedon_queenslandica",43615),rep.int("Capitella_telata",32175),rep.int("Danio_rerio",25606),rep.int("Drosophila_melanogaster",13931),rep.int("Helobdella_robusta",23432),rep.int("Homo_sapiens",21492),rep.int("Lottia_gigantea",23349),rep.int("Mnemiopsis_leidyi",16559),rep.int("Nematostella_vectensis",24773),rep.int("Strongylocentrotus_purpuratus",28987),rep.int("Taeniopygia_guttata",17488),rep.int("Trichoplax_adhaerens",11520))
write.csv(master.table,"master.table.csv",quote=FALSE,row.names=FALSE)
#Read in amalga homologs csv
agalma.homologs<-read.csv("compgen_homologs_nohydra_geneNames.csv",header=TRUE,sep=",")
#left join because need to know which genes have no homology too.
final.master.table<-left_join(master.table,agalma.homologs)%>%select(.,"seqid","start","end","gene","homology_id","catalog_id","animal")
write.csv(final.master.table,"final.master.table_absentgenes.csv",quote=FALSE,row.names=FALSE)
#double check that there are no duplicate genes in final.master.table
#duplicated(final.master.table$gene)%>%table()
#must run previous chunk first
#Take a subset! Otherwise following code will not complete running and freeze everything!!!
filter_target=c("Homo_sapiens","Danio_rerio")
master.table<-filter(master.table, animal==filter_target)
#There are human gene names in pep files that are not anywhere in gff3 files = inner_join
#Scaffold names may not be unique but must be - join seqid and catalog id
final.master.table_cluster<-inner_join(master.table,agalma.homologs)%>%dplyr::select(.,seqid,start,end,gene,homology_id,catalog_id)%>%mutate(species_scaffold=str_c(seqid,catalog_id,sep="_"))%>%dplyr::select(.,species_scaffold,homology_id)
#make contingency table
contingency<-table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)%>%as.matrix()
contingency<-1*(contingency>0)
#dissimilarity matrix
dist.matrix<-daisy(contingency,metric="gower",stand=FALSE)
#cluster
ag<-agnes(dist.matrix,diss=TRUE)
plot(ag)
cross.clust<-cc_crossclustering(dist.matrix,out=FALSE)
cc_get_cluster(cross.clust)
cross.clust
ncol(contingency)
nrow(contingency)
blah<-cc_get_cluster(cross.clust)
blah
data("toy")
toy
dist_t<-t(dist.matrix)
cross.clust<-cc_crossclustering(dist_t,out=FALSE)
cc_get_cluster(cross.clust)
cross.clust
nrow(dist_t)
ncol(dist_t)
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
echo=FALSE,
dpi=300,
cache=TRUE
)
library( tidyverse )
library(ggplot2)
library(seqinr)
library(ape)
library(Biostrings)
library(dplyr)
#clustering
library(cluster)
library(CrossClustering)
library(vegan)
#NOTE: due to lfs not working for public forks I am unable to host genome fastas in repo. Links to data provided in readme. For convenience I've included sample data.
#Ideally I would loop through all my fastas but for some reason I can't get looping to work...
fasta="data/sample_data/fasta_sample.fasta"
#histogram of contig lengths
read.fasta(fasta)%>%getLength(fasta)%>%as.data.frame()%>%filter(.<10000)%>%ggplot()+geom_histogram(aes(x=.), fill="skyblue3", color="black",binwidth=100)+xlab("Scaffold Length")
#stats
print(paste("Median scaffold/contig length (bp):",getLength(fasta)%>%median()))
#Please replace gff3_sample.gff3 with path to desired gff3 file. GFF3 files can be found in data/genomes/annot
#install.packages("ape")
gff3="data/sample_data/gff3_sample.gff3"
#parse gff3 and create new df with only seqid, type, start and end. Keep start and end coords for later analyses.
contig.gene.df <- ape::read.gff(file=gff3, GFF3=TRUE) %>% select(.,"seqid","type","start","end") %>% filter(.,type == "gene")
#for histogram, take just the contig names and gene counts
gene.count<- as.data.frame(table(contig.gene.df$seqid))
#plot frequency of frequencies
ggplot(data = gene.count, aes(x=gene.count$Freq)) + geom_histogram(binwidth=1) + geom_vline(xintercept = 3)
#stats
print(paste("proportion contigs with gene count >= 3:",nrow(subset(gene.count, gene.count$Freq >= 3))/nrow(gene.count)*100))
print(paste("Median no. genes/contig:",median(gene.count$Freq)))
print(paste("Max no. genes/contig:",max(gene.count$Freq)))
#install bioconductor 3.8 https://www.bioconductor.org/install/
#install Biostrings: BiocManager::install("Biostrings", version = "3.8") ; do not update mclust because it will have a warning and then biostrings module not installed.
#~~~~~ Beginning of 'story''s code.~~~~~
## read your fasta in as Biostrings object
fasta.s <- readDNAStringSet("./data/sample_data/fasta_sample.fasta")
## get the read names (in your case it has the isoform info)
names.fasta <- names(fasta.s)
## extract only the relevant gene and isoform (JM: aka pep) id (split name by the period symbol)
#JM: modify line to fit my name format
gene.iso <- sapply(names.fasta,function(j) cbind(unlist(strsplit(j,'\\:'))[1:8]))
## convert to good data.frame = transpose result from previous step and add relevant column names
gene.iso.df <- data.frame(t(gene.iso))
#JM: alter to put your own column names in:
colnames(gene.iso.df) <- c('p','pepID','s','scaffID','g','geneID','t','transID')
gene.iso.df<-select(gene.iso.df, geneID, pepID)
## and length of isoforms
gene.iso.df$width <- width(fasta.s)
#Did not use rest of code.
#~~~~~ End of 'story''s code.~~~~~
#JM:
gene.iso.df<-rownames_to_column(gene.iso.df)
#~~~~~beginning of code by nassimhddd (Jul 18 '16) Stackoverflow~~~~~
longest.pep.df <-gene.iso.df%>%group_by(geneID)%>%mutate(the_rank = rank(-width,ties.method="random")) %>%filter(the_rank==1)%>%select(-the_rank)
#~~~~~End of nassimhddd's code.~~~~~
list<-longest.pep.df[,1,drop=FALSE]
#wait why doesn't col.names=FALSE remove the column name?? Oh well.
write.csv(list,"Hydra_longestpep.txt",quote=FALSE,row.names=FALSE)
#set up empty df to rbind to
all.df<-data.frame(matrix(ncol=5,nrow=0))
names<-c("seqid","type","start","end","attributes")
colnames(all.df)<-names
#set up file names to loop through
gff3_dir="data/genomes/gff3/"
gff3=c("Amphimedon_queenslandica.Aqu1.42.gff3","Capitella_teleta.Capitella_teleta_v1.0.42.gff3","Danio_rerio.GRCz11.95.gff3","Drosophila_melanogaster.BDGP6.95.gff3","Helobdella_robusta.Helro1.42.gff3","Homo_sapiens.GRCh38.95.gff3","Lottia_gigantea.Lotgi1.42.gff3","Mnemiopsis_leidyi.MneLei_Aug2011.42.gff3","Nematostella_vectensis.ASM20922v1.42.gff3","Strongylocentrotus_purpuratus.Spur_3.1.42.gff3","Taeniopygia_guttata.taeGut3.2.4.95.gff3","Trichoplax_adhaerens.ASM15027v1.42.gff3")
for (blah in gff3)
{
gff3_path<-paste0(gff3_dir,blah)
contig.gene.df <- ape::read.gff(file=gff3_path, GFF3=TRUE) %>% dplyr::select(.,"seqid","type","start","end","attributes") %>% filter(.,type == "gene")
all.df<-bind_rows(all.df,contig.gene.df)
}
#Parse out the gene_id from the attributes
all.df$gene<-gsub(".*gene_id=(.*?);.*","\\1",all.df$attributes)
#Begin contstruction of MASTAAA! table.
master.table<-select(all.df,"seqid","start","end","gene")
#need to add animal ids"
master.table$animal<-c(rep.int("Amphimedon_queenslandica",43615),rep.int("Capitella_telata",32175),rep.int("Danio_rerio",25606),rep.int("Drosophila_melanogaster",13931),rep.int("Helobdella_robusta",23432),rep.int("Homo_sapiens",21492),rep.int("Lottia_gigantea",23349),rep.int("Mnemiopsis_leidyi",16559),rep.int("Nematostella_vectensis",24773),rep.int("Strongylocentrotus_purpuratus",28987),rep.int("Taeniopygia_guttata",17488),rep.int("Trichoplax_adhaerens",11520))
write.csv(master.table,"master.table.csv",quote=FALSE,row.names=FALSE)
#Read in amalga homologs csv
agalma.homologs<-read.csv("compgen_homologs_nohydra_geneNames.csv",header=TRUE,sep=",")
#left join because need to know which genes have no homology too.
final.master.table<-left_join(master.table,agalma.homologs)%>%select(.,"seqid","start","end","gene","homology_id","catalog_id","animal")
write.csv(final.master.table,"final.master.table_absentgenes.csv",quote=FALSE,row.names=FALSE)
#double check that there are no duplicate genes in final.master.table
#duplicated(final.master.table$gene)%>%table()
#must run previous chunk first
#Take a subset! Otherwise following code will not complete running and freeze everything!!!
filter_target=c("Homo_sapiens","Danio_rerio")
master.table<-filter(master.table, animal==filter_target)
#There are human gene names in pep files that are not anywhere in gff3 files = inner_join
#Scaffold names may not be unique but must be - join seqid and catalog id
final.master.table_cluster<-inner_join(master.table,agalma.homologs)%>%dplyr::select(.,seqid,start,end,gene,homology_id,catalog_id)%>%mutate(species_scaffold=str_c(seqid,catalog_id,sep="_"))%>%dplyr::select(.,species_scaffold,homology_id)
#make contingency table
contingency<-table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)%>%as.matrix()
contingency<-1*(contingency>0)
#dissimilarity matrix
dist.matrix<-daisy(contingency,metric="gower",stand=FALSE)
#cluster
ag<-agnes(dist.matrix,diss=TRUE)
plot(ag)
cross.clust<-cc_crossclustering(dist.matrix,out=FALSE)
cc_get_cluster(cross.clust)
clusters<-cc_get_cluster(cross.clust)
class(cluster)
class(cluster)
cluster<-cc_get_cluster(cross.clust)
class(cluster)
View(final.master.table_cluster)
View(final.master.table_cluster)
clust<-cc_get_cluster(cross.clust)
final.final.master.table<-mutate(final.master.table_cluster,cluster=clust)
View(final.master.table_cluster)
View(final.master.table)
View(master.table)
final.master.table_cluster<-inner_join(master.table,agalma.homologs)%>%dplyr::select(.,seqid,start,end,gene,homology_id,catalog_id)%>%mutate(species_scaffold=str_c(seqid,catalog_id,sep="_"))%>%dplyr::select(.,species_scaffold,homology_id,gene)
View(final.master.table_cluster)
contingency<-table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)%>%as.matrix()
contingency<-1*(contingency>0)
dist.matrix<-daisy(contingency,metric="gower",stand=FALSE)
View(contingency_table)
View(contingency)
ncol(contingency)
ncol(agalma.homologs)
nrow(agalma.homologs)
ncol(master.table)
#set up empty df to rbind to
all.df<-data.frame(matrix(ncol=5,nrow=0))
names<-c("seqid","type","start","end","attributes")
colnames(all.df)<-names
#set up file names to loop through
gff3_dir="data/genomes/gff3/"
gff3=c("Amphimedon_queenslandica.Aqu1.42.gff3","Capitella_teleta.Capitella_teleta_v1.0.42.gff3","Danio_rerio.GRCz11.95.gff3","Drosophila_melanogaster.BDGP6.95.gff3","Helobdella_robusta.Helro1.42.gff3","Homo_sapiens.GRCh38.95.gff3","Lottia_gigantea.Lotgi1.42.gff3","Mnemiopsis_leidyi.MneLei_Aug2011.42.gff3","Nematostella_vectensis.ASM20922v1.42.gff3","Strongylocentrotus_purpuratus.Spur_3.1.42.gff3","Taeniopygia_guttata.taeGut3.2.4.95.gff3","Trichoplax_adhaerens.ASM15027v1.42.gff3")
for (blah in gff3)
{
gff3_path<-paste0(gff3_dir,blah)
contig.gene.df <- ape::read.gff(file=gff3_path, GFF3=TRUE) %>% dplyr::select(.,"seqid","type","start","end","attributes") %>% filter(.,type == "gene")
all.df<-bind_rows(all.df,contig.gene.df)
}
#Parse out the gene_id from the attributes
all.df$gene<-gsub(".*gene_id=(.*?);.*","\\1",all.df$attributes)
#Begin contstruction of MASTAAA! table.
master.table<-select(all.df,"seqid","start","end","gene")
#need to add animal ids"
master.table$animal<-c(rep.int("Amphimedon_queenslandica",43615),rep.int("Capitella_telata",32175),rep.int("Danio_rerio",25606),rep.int("Drosophila_melanogaster",13931),rep.int("Helobdella_robusta",23432),rep.int("Homo_sapiens",21492),rep.int("Lottia_gigantea",23349),rep.int("Mnemiopsis_leidyi",16559),rep.int("Nematostella_vectensis",24773),rep.int("Strongylocentrotus_purpuratus",28987),rep.int("Taeniopygia_guttata",17488),rep.int("Trichoplax_adhaerens",11520))
write.csv(master.table,"master.table.csv",quote=FALSE,row.names=FALSE)
#Read in amalga homologs csv
agalma.homologs<-read.csv("compgen_homologs_nohydra_geneNames.csv",header=TRUE,sep=",")
#left join because need to know which genes have no homology too.
final.master.table<-left_join(master.table,agalma.homologs)%>%select(.,"seqid","start","end","gene","homology_id","catalog_id","animal")
write.csv(final.master.table,"final.master.table_absentgenes.csv",quote=FALSE,row.names=FALSE)
#double check that there are no duplicate genes in final.master.table
#duplicated(final.master.table$gene)%>%table()
ncol(master.table)
nrow(master.table)
ncol(final.master.table)
nrow(final.master.table)
tmp<-master.table
nrow(tmp)
master.table<-filter(master.table, animal==filter_target)
filter_target=c("Homo_sapiens","Danio_rerio")
master.table<-filter(master.table, animal==filter_target)
ncol(master.table)
ncol(tmp)
nrow(master.table)
ncol(inner_join(master.table,agalma.homologs))
numrow(inner_join(master.table,agalma.homologs))
nrow(inner_join(master.table,agalma.homologs))
final.master.table_cluster<-inner_join(master.table,agalma.homologs)%>%dplyr::select(.,seqid,start,end,gene,homology_id,catalog_id)%>%mutate(species_scaffold=str_c(seqid,catalog_id,sep="_"))%>%dplyr::select(.,species_scaffold,homology_id,gene)
nrow(final.master.table_cluster)
contingency<-table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)%>%as.matrix()
contingency<-1*(contingency>0)
nrow(contingency)
table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id)
View(table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id))
nrow(table(final.master.table_cluster$species_scaffold,final.master.table_cluster$homology_id))
contingency<-1*(contingency>0)
View(contingency)
nrow(contingency)
nrow(final.master.table_cluster$species_scaffold)
table(final.master.table_cluster$species_scaffold)
View(table(final.master.table_cluster$species_scaffold))
