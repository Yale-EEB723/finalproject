if (nrow(homolog.animals) > 1){
mrca <-getMRCA(phy,as.character(homolog.animals$animal))
bind.df<-cbind(homology_id=h,mrca)
mrca.df<-rbind(mrca.df,bind.df)
}
}
#Add MRCAs to master.table
new.master.table<-left_join(master.table,mrca.df, by="homology_id")
absent.df<-data.frame(homology_id="1",absent="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
if (absent.in.taxa == 0){
absent.in.taxa=NA
}
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-add_row(absent.df,homology_id=combine.df$h,absent=combine.df$absent.in.taxa)
taxa.list<-NULL
}
absent.in.taxa
if (absent.in.taxa == NULL){
absent.in.taxa=NA
}
length(absent.in.taxa)
absent.in.taxa<-setdiff(all.tips,taxa.list)
if (length(absent.in.taxa) == 0){
absent.in.taxa=NA
}
absent.in.taxa
absent.df<-data.frame(homology_id="1",absent="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
if (length(absent.in.taxa) == 0){
absent.in.taxa=NA
}
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-add_row(absent.df,homology_id=combine.df$h,absent=combine.df$absent.in.taxa)
taxa.list<-NULL
}
View(absent.df)
View(absent.df)
combine.df
absent.df<-data.frame(h="1",absent.in.taxa="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
if (length(absent.in.taxa) == 0){
absent.in.taxa=NA
}
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind(absent.df,combine.df)
taxa.list<-NULL
}
View(absent.df)
#initialize
mrca.df<-data.frame()
taxa.list<-NULL
#phylogeny
tree_text = "(Mnemiopsis_leidyi,(Amphimedon_queenslandica,(Trichoplax_adhaerens,(Nematostella_vectensis,((Drosophila_melanogaster,(Lottia_gigantea,(Capitella_telata,Helobdella_robusta))),(Strongylocentrotus_purpuratus,(Danio_rerio,(Homo_sapiens,Taeniopygia_guttata))))))));"
phy = read.tree(text=tree_text)
plot(phy)
#create a list of unique homology_ids; do not include NAs
homolog.list<-unique(master.table$homology_id)
homolog.list<-homolog.list[!is.na(homolog.list)]
for (h in homolog.list){
#1.Find all taxa that possess a particular homology_id.
homolog.animals<-master.table%>%filter(.,homology_id == h) %>% select(.,animal)%>%unique()
#2. Find the most recent common ancestor of all those taxa.
#If homology_id is possessed by only 1 taxon (eg. shared among paralogs), then skip. By default, there is no opportunity for detecting absence.
if (nrow(homolog.animals) == 1){
next
}
if (nrow(homolog.animals) > 1){
mrca <-getMRCA(phy,as.character(homolog.animals$animal))
bind.df<-cbind(homology_id=h,mrca)
mrca.df<-rbind(mrca.df,bind.df)
}
}
#Add MRCAs to master.table
new.master.table<-left_join(master.table,mrca.df, by="homology_id")
absent.df<-data.frame(h="1",absent.in.taxa="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
if (length(absent.in.taxa) == 0){
absent.in.taxa=NA
}
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind(absent.df,combine.df)
taxa.list<-NULL
}
names(absent.df)<-c("homology_id","absent")
new.master.table<-left_join(new.master.table,absent.df,by=homology_id)
VView(absent.df)
View(absent.df)
View(absent.df)
absent.df<-data.frame(h="1",absent.in.taxa="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
if (length(absent.in.taxa) == 0){
absent.in.taxa=NA
}
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind(absent.df,combine.df)
taxa.list<-NULL
}
absent.df<-data.frame(h="1",absent.in.taxa="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
if (length(absent.in.taxa) == 0){
next
}
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind(absent.df,combine.df)
taxa.list<-NULL
}
absent.df<-data.frame(h="1",absent.in.taxa="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
if (length(absent.in.taxa) == 0){
next
}
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind(absent.df,combine.df)
taxa.list<-NULL
}
View(absent.df)
absent.in.taxa
length(absent.in.taxa)
all.tips
taxa.list
setdiff<-all.tips,taxa.list
setdiff(all.tips,taxa.list)
unique(taxa.list)
all.tips
taxa$animal
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
taxa$animal
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
taxa.list
taxa$animal
find.taxa<-which(phy$tip.label==t)
find.taxa
taxa.list<-append(taxa.list,find.taxa)
taxa.list
taxa.list<-NULL
absent.df<-data.frame(h="1",absent.in.taxa="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
if (length(absent.in.taxa) == 0){
next
}
taxa.list<-NULL
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind(absent.df,combine.df)
}
absent.df<-data.frame(h="1",absent.in.taxa="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
taxa.list<-NULL
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind(absent.df,combine.df)
}
absent.in.taxa
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
taxa.list
all.tips
taxa.list<-NULL
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
if (length(absent.in.taxa)==0)
{absent.in.taxa<-0}
taxa.list<-NULL
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind(absent.df,combine.df)
}
View(absent.df)
print(h)
print(absent.in.taxa)
taxa.list<-NULL
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
#if (length(absent.in.taxa)==0)
#{absent.in.taxa<-0}
taxa.list<-NULL
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind.fill(absent.df,combine.df)
}
library(plyr)
absent.df<-data.frame(h="1",absent.in.taxa="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
#if (length(absent.in.taxa)==0)
#{absent.in.taxa<-0}
taxa.list<-NULL
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind.fill(absent.df,combine.df)
}
View(absent.df)
#initialize
mrca.df<-data.frame()
taxa.list<-NULL
#phylogeny
tree_text = "(Mnemiopsis_leidyi,(Amphimedon_queenslandica,(Trichoplax_adhaerens,(Nematostella_vectensis,((Drosophila_melanogaster,(Lottia_gigantea,(Capitella_telata,Helobdella_robusta))),(Strongylocentrotus_purpuratus,(Danio_rerio,(Homo_sapiens,Taeniopygia_guttata))))))));"
phy = read.tree(text=tree_text)
plot(phy)
#create a list of unique homology_ids; do not include NAs
homolog.list<-unique(master.table$homology_id)
homolog.list<-homolog.list[!is.na(homolog.list)]
for (h in homolog.list){
#1.Find all taxa that possess a particular homology_id.
homolog.animals<-master.table%>%filter(.,homology_id == h) %>% select(.,animal)%>%unique()
#2. Find the most recent common ancestor of all those taxa.
#If homology_id is possessed by only 1 taxon (eg. shared among paralogs), then skip. By default, there is no opportunity for detecting absence.
if (nrow(homolog.animals) == 1){
next
}
if (nrow(homolog.animals) > 1){
mrca <-getMRCA(phy,as.character(homolog.animals$animal))
bind.df<-cbind(homology_id=h,mrca)
mrca.df<-rbind(mrca.df,bind.df)
}
}
#Add MRCAs to master.table
new.master.table<-left_join(master.table,mrca.df, by="homology_id")
absent.df<-data.frame(h="1",absent.in.taxa="1")
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
#if (length(absent.in.taxa)==0)
#{absent.in.taxa<-0}
taxa.list<-NULL
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind.fill(absent.df,combine.df)
}
names(absent.df)<-c("homology_id","absent")
new.master.table<-left_join(new.master.table,absent.df,by=homology_id)
View(absent.df)
new.master.table<-left_join(new.master.table,absent.df)
class(new.master.table$homology_id)
absent.df<-data.frame(h=integer(0),absent.in.taxa=integer(0))
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
absent.in.taxa<-setdiff(all.tips,taxa.list)
#if (length(absent.in.taxa)==0)
#{absent.in.taxa<-0}
taxa.list<-NULL
print(h)
print(absent.in.taxa)
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind.fill(absent.df,combine.df)
}
names(absent.df)<-c("homology_id","absent")
new.master.table<-left_join(new.master.table,absent.df)
absence.analysis.result<-new.master.table[!is.na(new.master.table$absent),]
absence.analysis.result
write.csv(absence.analysis.result,"absence.analysis.result.csv",quote=FALSE,row.names=FALSE)
View(absent.df)
View(absence.analysis.result)
View(master.table)
View(absent.df)
nona<-na.omit(absent.df)
View(nona)
View(new.master.table)
View(absent.df)
absent.df<-na.omit(absent.df)
names(absent.df)<-c("homology_id","absent")
View(absent.df)
left_join(master.table,absent.df,by=homology_id)
left_join(master.table,absent.df,by="homology_id")
left_join(master.table,absent.df,by="homology_id")%>%select(.,"species_scaffold","gene",homology_id","absent")
left_join(master.table,absent.df,by="homology_id")%>%select(.,species_scaffold,gene,homology_id,absent)
left_join(master.table,absent.df,by="homology_id")%>%select(.,species_scaffold,gene,homology_id,absent)%>%na.omit(absent.df)
left_join(master.table,absent.df,by="homology_id")%>%select(.,species_scaffold,gene,homology_id,absent)%>%na.omit(absent)
left_join(master.table,absent.df,by="homology_id")%>%select(.,species_scaffold,gene,homology_id,absent)%>%na.omit(absent)%>%order(homology_id)
left_join(master.table,absent.df,by="homology_id")%>%select(.,species_scaffold,gene,homology_id,absent)%>%na.omit(absent)%>%order("homology_id")
blooh<-left_join(master.table,absent.df,by="homology_id")%>%select(.,species_scaffold,gene,homology_id,absent)%>%na.omit(absent)
View(blooh)
blooh[order(blooh,homology_id)]
blooh[order(blooh,blooh$homology_id)]
blooh[with(order(blooh,blooh$homology_id)),]
left_join(master.table,absent.df,by="homology_id")%>%select(.,species_scaffold,gene,homology_id,absent)%>%na.omit(absent)%>%arrange()
left_join(master.table,absent.df,by="homology_id")%>%select(.,species_scaffold,gene,homology_id,absent)%>%na.omit(absent)%>%group_by(homology_id)
absence.results<-left_join(master.table,absent.df,by="homology_id")%>%select(.,species_scaffold,gene,homology_id,absent)%>%na.omit(absent)%>%group_by(homology_id)
View(absence.results)
#initialize
mrca.df<-data.frame()
taxa.list<-NULL
#phylogeny
tree_text = "(Mnemiopsis_leidyi,(Amphimedon_queenslandica,(Trichoplax_adhaerens,(Nematostella_vectensis,((Drosophila_melanogaster,(Lottia_gigantea,(Capitella_telata,Helobdella_robusta))),(Strongylocentrotus_purpuratus,(Danio_rerio,(Homo_sapiens,Taeniopygia_guttata))))))));"
phy = read.tree(text=tree_text)
plot(phy)
#create a list of unique homology_ids; do not include NAs
homolog.list<-unique(master.table$homology_id)
homolog.list<-homolog.list[!is.na(homolog.list)]
for (h in homolog.list){
#1.Find all taxa that possess a particular homology_id.
homolog.animals<-master.table%>%filter(.,homology_id == h) %>% select(.,animal)%>%unique()
#2. Find the most recent common ancestor of all those taxa.
#If homology_id is possessed by only 1 taxon (eg. shared among paralogs), then skip. By default, there is no opportunity for detecting absence.
if (nrow(homolog.animals) == 1){
next
}
if (nrow(homolog.animals) > 1){
mrca <-getMRCA(phy,as.character(homolog.animals$animal))
bind.df<-cbind(homology_id=h,mrca)
mrca.df<-rbind(mrca.df,bind.df)
}
}
#Add MRCAs to master.table
new.master.table<-left_join(master.table,mrca.df, by="homology_id")
absent.df<-data.frame(h=integer(0),absent.in.taxa=integer(0))
for (h in mrca.df$homology_id){
#3. Find all the tips of the last common ancestor.
all.tips<-mrca.df$mrca[mrca.df$homology_id==h]%>%descendants(phy,.)
all.tips<-all.tips[all.tips<=length(phy$tip.label)]
taxa<-new.master.table%>%filter(homology_id==h)%>%select(.,animal)%>%unique()
#first find the node number of all animals that taxa with that homology_id
for (t in taxa$animal){
find.taxa<-which(phy$tip.label==t)
taxa.list<-append(taxa.list,find.taxa)
}
#4. Compare which tips do not possess the homology_id.
#Where ther eare no differences absent.in.taxa will equal integer(0). Hence need rbind.fill
absent.in.taxa<-setdiff(all.tips,taxa.list)
taxa.list<-NULL
#append to table of homology_id + absent.in.taxa
combine.df<-cbind(h,absent.in.taxa)%>%as.data.frame()
absent.df<-rbind.fill(absent.df,combine.df)
}
#edit absent.df
#remove NAs in 'absent' column - these are homologs not absent in any of the child taxa.
absent.df<-na.omit(absent.df)
names(absent.df)<-c("homology_id","absent")
new.master.table<-left_join(new.master.table,absent.df)
absence.results<-left_join(master.table,absent.df,by="homology_id")%>%select(.,species_scaffold,gene,homology_id,absent)%>%na.omit(absent)%>%group_by(homology_id)
write.csv(absence.results,"absence.analysis.results.csv",quote=FALSE,row.names=FALSE)
